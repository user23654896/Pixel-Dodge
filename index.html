<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Responsive 2D KaÃ§Ä±nma Oyunu</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body {
            margin: 0;
            background: #111;
            /* Ana sayfa kaydÄ±rmasÄ±nÄ± engeller, bu Ã¶nemli */
            overflow: hidden; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
            text-align: center;
        }
        
        /* Skor GÃ¶rÃ¼ntÃ¼leme */
        #scoreDisplay {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 40px;
            font-weight: bold;
        }
        #highScoreDisplay {
            position: absolute;
            top: 80px;
            left: 20px;
            font-size: 30px;
            font-weight: bold;
            color: #ffeb3b;
        }

        /* --- MENÃœ ALANI (KAYDIRMA DÃœZELTÄ°LDÄ°) --- */
        #menu {
            position: absolute;
            width: 100%;
            top: 15%; 
            /* Mobil kaydÄ±rma iÃ§in */
            max-height: 80vh; 
            overflow-y: auto;
            padding-bottom: 50px; 
        }

        /* --- OYUN SONU ve KURALLAR PENCERELERÄ° --- */
        #rulesOverlay, #gameOver {
            position: fixed; 
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            z-index: 100;
            background-color: rgba(0, 0, 0, 0.9);
            text-align: center;
        }
        
        /* --- OYUN KURALLARI Ä°Ã‡ERÄ°ÄÄ° (KAYDIRMA DÃœZELTÄ°LDÄ°) --- */
        #rulesContent {
            width: 90%;
            max-width: 600px;
            margin: 5% auto; 
            background-color: #333;
            padding: 30px;
            border-radius: 15px;
            text-align: left;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            
            /* Mobil KaydÄ±rma DÃ¼zeltmesi */
            max-height: 90vh; 
            overflow-y: auto; 
            padding-bottom: 80px;
        }
        
        #rulesContent h2 {
            text-align: center;
            color: #4CAF50;
        }
        #rulesContent ul {
            font-size: 22px;
            line-height: 1.5;
            list-style-type: none;
            padding-left: 0;
        }
        #rulesContent li {
             margin-bottom: 10px;
             padding-left: 1.5em; 
             text-indent: -1.5em; 
        }
        #rulesContent li::before {
             content: "ğŸ‘‰"; 
             margin-right: 0.5em;
        }
        .control-list {
            list-style-type: none;
            padding: 10px;
            border: 1px dashed #FFC107;
            border-radius: 5px;
            margin-top: 10px;
        }
        
        /* --- BUTON STÄ°LLERÄ° --- */
        button {
            padding: 20px 40px; 
            font-size: 24px;
            margin: 10px;
            cursor: pointer;
            border-radius: 12px;
            border: none;
            background-color: #4CAF50;
            color: white;
            transition: background-color 0.3s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        button:hover {
            background-color: #45a049;
        }
        #rulesButton {
            background-color: #FFC107; 
            color: black;
        }
        #rulesButton:hover {
            background-color: #ffb300;
        }
        #fullscreenButton {
            background-color: #2196F3;
        }
        #fullscreenButton:hover {
            background-color: #1976D2;
        }
        
        /* Kapatma butonu, iÃ§erik kaydÄ±rÄ±lsa bile altta kalÄ±r */
        #closeRulesButton {
            background-color: #F44336;
            color: white;
            padding: 15px 30px;
            font-size: 24px;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            width: 100%;
            display: block;
            margin-top: 30px;
            position: sticky; 
            bottom: 0;
            z-index: 10;
        }
        
        /* --- DOKUNMATÄ°K KONTROL ALANI --- */
        #touchControls {
            display: none; 
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 150px;
            z-index: 50;
        }
        .touch-button {
            position: absolute;
            bottom: 10px;
            width: 45%;
            height: 120px;
            background-color: rgba(76, 175, 80, 0.7); 
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 50px;
            user-select: none; 
            touch-action: manipulation; 
        }
        #leftButton { left: 2%; }
        #rightButton { right: 2%; }
        
        #gameOver {
            top: 30%;
            position: absolute;
            width: 100%;
            height: auto;
            font-size: 80px;
            text-shadow: 0 0 10px red;
            background-color: transparent; 
        }
    </style>
</head>
<body>

<canvas id="gameCanvas"></canvas>

<div id="scoreDisplay">Score: 0</div>
<div id="highScoreDisplay">High Score: 0</div>

<div id="touchControls">
    <div id="leftButton" class="touch-button">â¬…ï¸</div>
    <div id="rightButton" class="touch-button">â¡ï¸</div>
</div>

<div id="rulesOverlay">
    <div id="rulesContent">
        <h2>ğŸ® Oyun KurallarÄ±</h2>
        <ul>
            <li>**AmaÃ§:** YukarÄ±dan dÃ¼ÅŸen kÄ±rmÄ±zÄ± karelere Ã§arpmadan mÃ¼mkÃ¼n olduÄŸunca uzun sÃ¼re hayatta kalmak.</li>
            <li>**Kazanma:** DÃ¼ÅŸmanlar ekranÄ±n altÄ±ndan geÃ§tiÄŸinde skor kazanÄ±rsÄ±nÄ±z.</li>
            <li>**Kaybetme:** Herhangi bir kÄ±rmÄ±zÄ± dÃ¼ÅŸmana Ã§arptÄ±ÄŸÄ±nÄ±zda oyun biter.</li>
            <li>**Zorluk:** Skorunuz arttÄ±kÃ§a dÃ¼ÅŸmanlarÄ±n hÄ±zÄ± artar ve daha sÄ±k dÃ¼ÅŸmeye baÅŸlarlar!</li>
            <li>**YÃ¼ksek Skor:** En yÃ¼ksek skorunuz tarayÄ±cÄ±nÄ±zda kayÄ±t altÄ±nda tutulur.</li>
        </ul>
        
        <hr style="border-color: #555;">
        
        <h3 style="text-align: center; color: #2196F3;">Kontrol YÃ¶ntemleri</h3>
        
        <ul class="control-list">
            <li>**ğŸ’» PC/MasaÃ¼stÃ¼ KontrolÃ¼:**</li>
            <li>ğŸ‘‰ Sol Hareket: **Sol Ok (â¬…ï¸)** tuÅŸu</li>
            <li>ğŸ‘‰ SaÄŸ Hareket: **SaÄŸ Ok (â¡ï¸)** tuÅŸu</li>
        </ul>
        
        <ul class="control-list">
            <li>**ğŸ“± Mobil/Dokunmatik KontrolÃ¼:**</li>
            <li>ğŸ‘‰ Hareket: EkranÄ±n altÄ±ndaki **â¬…ï¸ ve â¡ï¸ butonlarÄ±na** dokunup basÄ±lÄ± tutun.</li>
        </ul>
        
        <button id="closeRulesButton" onclick="toggleRules()">Kapat</button>
    </div>
</div>

<div id="menu">
    <h1 style="font-size: 80px; color: #ffeb3b;">ğŸš€ 2D KaÃ§Ä±nma Oyunu</h1>
    <h2 style="font-size: 40px;">En YÃ¼ksek Skor: <span id="menuHighScore">0</span></h2>
    
    <button id="rulesButton" onclick="toggleRules()">Oyun KurallarÄ±</button>
    <button id="fullscreenButton" onclick="toggleFullscreen()">Tam Ekrana Al</button> 
    
    <br>
    <button onclick="startGame('easy')">Kolay</button>
    <button onclick="startGame('normal')">Orta</button>
    <button onclick="startGame('hard')">Zor</button>
</div>

<div id="gameOver">
    <div>
        GAME OVER<br>
        Final Score: <span id="finalScore">0</span><br>
        <div id="newHighScoreText" style="color: yellow; font-size: 40px; margin-top: 10px; display: none;">YENÄ° EN YÃœKSEK SKOR!</div><br>
        
        <button id="fullscreenButton" onclick="toggleFullscreen()">Tam Ekrana Al</button> 
        <button onclick="restartGame()">Yeniden Oyna</button>
    </div>
</div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const scoreDisplay = document.getElementById("scoreDisplay");
    const finalScoreSpan = document.getElementById("finalScore");
    const highScoreDisplay = document.getElementById("highScoreDisplay");
    const menuHighScoreSpan = document.getElementById("menuHighScore");
    const newHighScoreText = document.getElementById("newHighScoreText");
    const rulesOverlay = document.getElementById("rulesOverlay");
    const touchControls = document.getElementById("touchControls"); 
    const leftButton = document.getElementById("leftButton");     
    const rightButton = document.getElementById("rightButton");   
    const menuDiv = document.getElementById("menu");

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let playerImg = new Image();
    playerImg.src = "character.png"; 

    let enemies = [];
    let initialEnemySpeed = 4;
    let initialSpawnRate = 1000;
    let enemySpeed = initialEnemySpeed;
    let spawnRate = initialSpawnRate;
    let score = 0;
    let alive = false;
    let gameInterval;
    let spawnTimeout;

    let player = {
        w: 80,
        h: 80,
        x: canvas.width / 2 - 40,
        y: canvas.height - 150,
        speed: 15
    };
    
    // --- OYUNCU HAREKET VE DOKUNMATÄ°K KONTROLLER ---
    function movePlayer(direction) {
        if (!alive) return;
        if (direction === 'left') {
            player.x = Math.max(0, player.x - player.speed);
        } else if (direction === 'right') {
            player.x = Math.min(canvas.width - player.w, player.x + player.speed);
        }
    }

    let moveInterval;
    const startMoving = (direction) => {
        if (!moveInterval) {
            movePlayer(direction);
            moveInterval = setInterval(() => movePlayer(direction), 1000 / 60); 
        }
    };

    const stopMoving = () => {
        if (moveInterval) {
            clearInterval(moveInterval);
            moveInterval = null;
        }
    };

    leftButton.addEventListener('touchstart', (e) => { e.preventDefault(); startMoving('left'); });
    leftButton.addEventListener('touchend', stopMoving);
    leftButton.addEventListener('touchcancel', stopMoving);
    rightButton.addEventListener('touchstart', (e) => { e.preventDefault(); startMoving('right'); });
    rightButton.addEventListener('touchend', stopMoving);
    rightButton.addEventListener('touchcancel', stopMoving);
    leftButton.addEventListener('mousedown', () => startMoving('left'));
    leftButton.addEventListener('mouseup', stopMoving);
    leftButton.addEventListener('mouseleave', stopMoving);
    rightButton.addEventListener('mousedown', () => startMoving('right'));
    rightButton.addEventListener('mouseup', stopMoving);
    rightButton.addEventListener('mouseleave', stopMoving);

    // --- YÃœKSEK SKOR Ä°ÅLEVLERÄ° ---
    function getHighScore() {
        const highscore = localStorage.getItem('2d_game_highscore');
        return highscore ? parseInt(highscore) : 0;
    }

    function saveScore(currentScore) {
        const highScore = getHighScore();
        if (currentScore > highScore) {
            localStorage.setItem('2d_game_highscore', currentScore);
            return true;
        }
        return false;
    }
    
    function updateScoreDisplays() {
        const highScore = getHighScore();
        highScoreDisplay.innerText = "High Score: " + highScore;
        menuHighScoreSpan.innerText = highScore;
    }
    
    updateScoreDisplays();
    
    // --- OYUN AKIÅ KONTROLÃœ ---
    function startGame(mode) {
        cancelAnimationFrame(gameInterval);
        clearTimeout(spawnTimeout);
        
        menuDiv.style.display = "none";
        document.getElementById("gameOver").style.display = "none";
        newHighScoreText.style.display = "none";
        touchControls.style.display = "flex"; 

        if (mode === "easy") { initialEnemySpeed = 4; initialSpawnRate = 1000; }
        if (mode === "normal") { initialEnemySpeed = 6; initialSpawnRate = 700; }
        if (mode === "hard") { initialEnemySpeed = 8; initialSpawnRate = 500; }
        
        enemySpeed = initialEnemySpeed;
        spawnRate = initialSpawnRate;
        alive = true;
        score = 0;
        enemies = [];
        player.x = canvas.width / 2 - player.w / 2; 

        scoreDisplay.style.display = "block";
        scoreDisplay.innerText = "Score: " + score;
        updateScoreDisplays();

        spawnEnemies();
        gameLoop();
    }
    
    function spawnEnemies() {
        if (!alive) return;
        enemies.push({
            x: Math.random() * (canvas.width - 40),
            y: -50,
            w: 40,
            h: 40
        });
        spawnTimeout = setTimeout(spawnEnemies, spawnRate);
    }

    function drawPlayer() {
        if (playerImg.complete && playerImg.naturalWidth !== 0) {
            ctx.drawImage(playerImg, player.x, player.y, player.w, player.h);
        } else {
            ctx.fillStyle = "blue";
            ctx.fillRect(player.x, player.y, player.w, player.h);
        }
    }

    function updateEnemies() {
        const newEnemies = [];
        let hit = false;
        
        for (let e of enemies) {
            e.y += enemySpeed;
            ctx.fillStyle = "red";
            ctx.fillRect(e.x, e.y, e.w, e.h);

            if (player.x < e.x + e.w && player.x + player.w > e.x &&
                player.y < e.y + e.h && player.y + player.h > e.y) {
                hit = true;
                break;
            }

            if (e.y > canvas.height) {
                score++;
            } else {
                newEnemies.push(e); 
            }
        }
        
        enemies = newEnemies;
        if (hit) {
            gameOver();
        }
    }

    function updateScoreAndDifficulty() {
        scoreDisplay.innerText = "Score: " + score;
        
        if (score > 0 && score % 10 === 0) {
            enemySpeed = initialEnemySpeed + Math.floor(score / 10) * 0.5;
            const minSpawnRate = 300;
            spawnRate = Math.max(minSpawnRate, initialSpawnRate - Math.floor(score / 10) * 50); 
        }
    }
    
    function gameLoop() {
        if (!alive) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawPlayer();
        updateEnemies();
        updateScoreAndDifficulty();
        gameInterval = requestAnimationFrame(gameLoop);
    }

    function gameOver() {
        alive = false;
        clearTimeout(spawnTimeout);
        cancelAnimationFrame(gameInterval);
        
        const isNewHighScore = saveScore(score);
        updateScoreDisplays();
        
        finalScoreSpan.innerText = score;
        
        if (isNewHighScore) {
            newHighScoreText.style.display = "block";
        }

        document.getElementById("gameOver").style.display = "block";
        scoreDisplay.style.display = "none";
        touchControls.style.display = "none"; 
        stopMoving(); 
    }

    function restartGame() {
        document.getElementById("gameOver").style.display = "none";
        if (document.fullscreenElement) {
             document.exitFullscreen();
        }
        startGame("easy"); 
    }
    
    // --- GÃ–RÃœNTÃœ VE BOYUTLANDIRMA ---
    function toggleFullscreen() {
        const doc = document.documentElement;
        
        if (document.fullscreenElement) {
            document.exitFullscreen();
        } 
        else if (doc.requestFullscreen) {
            doc.requestFullscreen();
        } else if (doc.mozRequestFullScreen) {
            doc.mozRequestFullScreen();
        } else if (doc.webkitRequestFullscreen) {
            doc.webkitRequestFullscreen();
        } else if (doc.msRequestFullscreen) {
            doc.msRequestFullscreen();
        }
        
        setTimeout(updateCanvasAndPlayerPosition, 50); 
    }
    
    function updateCanvasAndPlayerPosition() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        player.x = canvas.width / 2 - player.w / 2;
        player.y = canvas.height - 150;
    }

    window.addEventListener('resize', updateCanvasAndPlayerPosition);
    document.addEventListener('fullscreenchange', updateCanvasAndPlayerPosition);

    // --- KURALLAR KONTROLÃœ ---
    function toggleRules() {
        if (rulesOverlay.style.display === "block") {
            rulesOverlay.style.display = "none";
            menuDiv.style.display = "block"; 
        } else {
            rulesOverlay.style.display = "block";
            menuDiv.style.display = "none"; 
        }
    }

    // --- PC KLAVYE KONTROLLERÄ° ---
    window.addEventListener("keydown", e => {
        if (!alive) return;
        
        if (e.key === "ArrowLeft") {
            movePlayer('left');
        }
        if (e.key === "ArrowRight") {
            movePlayer('right');
        }
    });
</script>

</body>
</html>
